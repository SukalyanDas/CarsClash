<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarClash - Vehicle Comparison Showdown</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-car-crash"></i>
                <h1>CarClash</h1>
                <span class="byline">by Sukalyan Das</span>
            </div>
            <nav>
                <a href="#home" class="nav-link active" data-page="home">Home</a>
                <a href="#browse" class="nav-link" data-page="browse">Browse Cars</a>
                <a href="#compare" class="nav-link" data-page="compare">Compare</a>
                <a href="#predictor" class="nav-link" data-page="predictor">Price Predictor</a>
                <a href="stats.html" class="nav-link" id="stats-link">Market Stats</a>
                <a href="#about" class="nav-link" data-page="about">About</a>
            </nav>
        </div>
    </header>

    <div class="page-container">
        <!-- Home Page -->
        <div id="home" class="page active">
            <div class="hero">
                <h2>Find Your Perfect Car</h2>
                <p>Compare specifications, prices, and features in the ultimate vehicle showdown</p>
                <a href="#browse" class="btn" data-page="browse">Start Comparing</a>
            </div>
            
            <div class="features">
                <div class="feature-card">
                    <i class="fas fa-search"></i>
                    <h3>Find Cars</h3>
                    <p>Browse through our extensive collection of vehicles from various manufacturers</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-exchange-alt"></i>
                    <h3>Compare</h3>
                    <p>Select multiple cars to compare their specifications side by side</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-trophy"></i>
                    <h3>Decide</h3>
                    <p>Make informed decisions with detailed comparisons and highlighted winners</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-brain"></i>
                    <h3>AI Price Prediction</h3>
                    <p>Use our TensorFlow.js powered model to predict car prices based on specifications</p>
                </div>
            </div>
        </div>
        
        <!-- Browse Cars Page -->
        <div id="browse" class="page">
            <h2 class="page-title">Browse Cars</h2>
            <p class="page-subtitle">Select vehicles to compare their specifications and features</p>
            
            <div class="controls">
                <div class="filter-section">
                    <select id="type-filter">
                        <option value="all">All Types</option>
                        <option value="suv">SUV</option>
                        <option value="sedan">Sedan</option>
                        <option value="truck">Truck</option>
                        <option value="electric">Electric</option>
                    </select>
                    
                    <select id="price-filter">
                        <option value="all">Any Price</option>
                        <option value="low">Under $30,000</option>
                        <option value="medium">$30,000 - $50,000</option>
                        <option value="high">Over $50,000</option>
                    </select>
                    
                    <select id="brand-filter">
                        <option value="all">All Brands</option>
                        <option value="toyota">Toyota</option>
                        <option value="ford">Ford</option>
                        <option value="honda">Honda</option>
                        <option value="tesla">Tesla</option>
                        <option value="bmw">BMW</option>
                        <option value="mercedes">Mercedes</option>
                        <option value="cadillac">Cadillac</option>
                        <option value="audi">Audi</option>
                        <option value="genesis">Genesis</option>
                        <option value="lexus">Lexus</option>
                        <option value="nissan">Nissan</option>
                        <option value="kia">Kia</option>
                        <option value="subaru">Subaru</option>
                    </select>
                </div>

                
                <button class="compare-btn" id="compare-button">
                    <i class="fas fa-exchange-alt"></i> Compare Selected Cars
                </button>
               
            </div>
            
            <div class="cars-grid" id="cars-container">
                <!-- Car cards will be generated here -->
            </div>
        </div>
        
        <!-- Compare Page -->
        <div id="compare" class="page">
            <h2 class="page-title">Car Comparison</h2>
            <p class="page-subtitle">Detailed side-by-side comparison of selected vehicles</p>
            
            <div class="comparison-section" id="comparison-section">
                <h3 class="comparison-title">Comparison Results</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Specification</th>
                            <!-- Car names will be added here dynamically -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Comparison data will be added here dynamically -->
                    </tbody>
                </table>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <a href="#browse" class="btn" data-page="browse">Select More Cars</a>
            </div>
        </div>
        
        <!-- Price Predictor Page -->
        <div id="predictor" class="page">
            <h2 class="page-title">AI Car Price Predictor</h2>
            <p class="page-subtitle">Predict car prices using TensorFlow.js machine learning model</p>
            
            <div class="predictor-section">
                <div class="model-status">
                    <div class="status-indicator">
                        <i class="fas fa-circle-notch fa-spin" id="status-icon"></i>
                        <span id="model-status">Loading TensorFlow.js model...</span>
                    </div>
                </div>
                
                <div class="predictor-content">
                    <div class="predictor-card">
                        <h3><i class="fas fa-cogs"></i> Enter Car Specifications</h3>
                        <form id="prediction-form">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="input-horsepower">
                                        <i class="fas fa-tachometer-alt"></i> Horsepower
                                    </label>
                                    <input type="number" id="input-horsepower" min="100" max="600" value="200" required>
                                    <small>Range: 100 - 600 HP</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="input-mpg">
                                        <i class="fas fa-gas-pump"></i> MPG (Combined)
                                    </label>
                                    <input type="number" id="input-mpg" min="10" max="50" value="25" required>
                                    <small>Range: 10 - 50 MPG</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="input-seating">
                                        <i class="fas fa-users"></i> Seating Capacity
                                    </label>
                                    <select id="input-seating" required>
                                        <option value="5">5 Seats</option>
                                        <option value="7">7 Seats</option>
                                        <option value="8">8 Seats</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="input-type">
                                        <i class="fas fa-car"></i> Vehicle Type
                                    </label>
                                    <select id="input-type" required>
                                        <option value="sedan">Sedan</option>
                                        <option value="suv">SUV</option>
                                        <option value="truck">Truck</option>
                                        <option value="electric">Electric</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="input-drive">
                                        <i class="fas fa-road"></i> Drive Type
                                    </label>
                                    <select id="input-drive" required>
                                        <option value="FWD">FWD (Front-Wheel Drive)</option>
                                        <option value="RWD">RWD (Rear-Wheel Drive)</option>
                                        <option value="AWD">AWD (All-Wheel Drive)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="input-brand">
                                        <i class="fas fa-building"></i> Brand Category
                                    </label>
                                    <select id="input-brand" required>
                                        <option value="economy">Economy (Toyota, Honda, Nissan)</option>
                                        <option value="luxury">Luxury (BMW, Mercedes, Audi)</option>
                                        <option value="premium">Premium (Lexus, Cadillac, Genesis)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button type="submit" class="predict-btn" id="predict-btn">
                                <i class="fas fa-magic"></i> Predict Price
                            </button>
                        </form>
                    </div>
                    
                    <div class="prediction-result" id="prediction-result" style="display: none;">
                        <div class="result-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <h3>Predicted Price</h3>
                        <div class="predicted-price" id="predicted-price">$0</div>
                        <p class="result-description">
                            Based on the specifications you provided, our TensorFlow.js model predicts this price range for your vehicle.
                        </p>
                        <div class="confidence-info">
                            <i class="fas fa-info-circle"></i>
                            <small>This prediction is based on <span id="training-samples">0</span> real vehicle data points</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- About Page -->
        <div id="about" class="page">
            <h2 class="page-title">About CarClash</h2>
            <p class="page-subtitle">Learn more about our mission and how to use our comparison tool</p>
            
            <div class="about-content">
                <h3>Our Mission</h3>
                <p>CarClash was created to help car buyers make informed decisions by providing a comprehensive comparison tool that highlights the differences between vehicles. We believe that everyone should have access to clear, unbiased information when making such an important purchase.</p>
                
                <h3>How to Use</h3>
                <p>1. Navigate to the Browse Cars page to see our selection of vehicles</p>
                <p>2. Use the filters to narrow down your search by type, price range, or brand</p>
                <p>3. Select the cars you want to compare by checking the comparison boxes</p>
                <p>4. Click the "Compare Selected Cars" button to see a detailed side-by-side comparison</p>
                <p>5. Use the AI Price Predictor to estimate car prices based on custom specifications</p>
                <p>6. Analyze the results to determine which vehicle best meets your needs</p>
                
                <h3>AI Price Prediction</h3>
                <p>Our platform features a TensorFlow.js-powered machine learning model that runs entirely in your browser. This model is trained on real vehicle data to predict car prices based on specifications like horsepower, fuel efficiency, seating capacity, and more. The predictions are made instantly on your device without requiring any backend servers, ensuring privacy and speed.</p>
                
                <h3>Data Sources</h3>
                <p>Our vehicle data is sourced from manufacturer specifications and is regularly updated to ensure accuracy. All prices are based on manufacturer suggested retail price (MSRP) and may vary by dealer.</p>
            </div>
        </div>
    </div>

    <footer>
        <p>CarClash &copy; 2023 | Compare your favorite vehicles side by side</p>
        <p>Created with passion, this page is designed for anyone who loves cars and wants to make smart, informed choices before buying. We believe that knowledge is the key to driving satisfaction, and we're here to make that process easier for you.</p>
        <p>Join us on the journey to find your ideal car, and let's make every drive count!</p>
    </footer>

    <!-- Import car data from external file -->
    <script src="cars-data.js"></script>
    
    <script>

        // DOM elements
        const carsContainer = document.getElementById('cars-container');
        const typeFilter = document.getElementById('type-filter');
        const priceFilter = document.getElementById('price-filter');
        const brandFilter = document.getElementById('brand-filter');
        const compareButton = document.getElementById('compare-button');
        const comparisonSection = document.getElementById('comparison-section');
        const comparisonTable = document.querySelector('.comparison-table');
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');

        // Initialize the page with cars
        function renderCars(carsToRender) {
            carsContainer.innerHTML = '';
            
            if (carsToRender.length === 0) {
                carsContainer.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 40px; font-size: 1.2rem;">No cars match your selected filters. Please try different criteria.</p>';
                return;
            }
            
            carsToRender.forEach(car => {
                const carCard = document.createElement('div');
                carCard.className = 'car-card';
                carCard.innerHTML = `
                    <div class="car-badge">${car.type.toUpperCase()}</div>
                    <div class="car-image">
                        <img src="${car.image}" alt="${car.name}">
                    </div>
                    <div class="car-details">
                        <div class="car-title">
                            <h2>${car.name}</h2>
                            <div class="car-price">$${car.price.toLocaleString()}</div>
                        </div>
                        <div class="car-specs">
                            <div class="spec">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>${car.specs.horsepower} HP</span>
                            </div>
                            <div class="spec">
                                <i class="fas fa-gas-pump"></i>
                                <span>${car.specs.mpg}</span>
                            </div>
                            <div class="spec">
                                <i class="fas fa-cogs"></i>
                                <span>${car.specs.engine}</span>
                            </div>
                            <div class="spec">
                                <i class="fas fa-road"></i>
                                <span>${car.specs.drive}</span>
                            </div>
                        </div>
                        <div class="select-car">
                            <input type="checkbox" class="select-checkbox" data-car-id="${car.id}">
                            <label>Select for comparison</label>
                        </div>
                    </div>
                `;
                carsContainer.appendChild(carCard);
            });
        }

        // Filter cars based on selections
        function filterCars() {
            const typeValue = typeFilter.value;
            const priceValue = priceFilter.value;
            const brandValue = brandFilter.value;
            
            const filteredCars = cars.filter(car => {
                // Type filter
                if (typeValue !== 'all' && car.type !== typeValue) return false;
                
                // Brand filter
                if (brandValue !== 'all' && car.brand !== brandValue) return false;
                
                // Price filter
                if (priceValue !== 'all') {
                    if (priceValue === 'low' && car.price >= 30000) return false;
                    if (priceValue === 'medium' && (car.price < 30000 || car.price > 50000)) return false;
                    if (priceValue === 'high' && car.price <= 50000) return false;
                }
                
                return true;
            });
            
            renderCars(filteredCars);
        }

        // Compare selected cars
        function compareCars() {
            const selectedCheckboxes = document.querySelectorAll('.select-checkbox:checked');
            
            if (selectedCheckboxes.length < 2) {
                alert('Please select at least 2 cars to compare');
                return;
            }
            
            const selectedCarIds = Array.from(selectedCheckboxes).map(checkbox => parseInt(checkbox.dataset.carId));
            const selectedCars = cars.filter(car => selectedCarIds.includes(car.id));
            
            // Build comparison table
            let tableHTML = `
                <thead>
                    <tr>
                        <th>Specification</th>
            `;
            
            // Add car names to header
            selectedCars.forEach(car => {
                tableHTML += `<th class="car-header">
                    <img src="${car.image}" alt="${car.name}">
                    <div>${car.name}</div>
                    <div class="car-price">$${car.price.toLocaleString()}</div>
                </th>`;
            });
            
            tableHTML += `</tr></thead><tbody>`;
            
            // Add specifications rows
            const specKeys = Object.keys(selectedCars[0].specs);
            
            specKeys.forEach(spec => {
                tableHTML += `<tr><th>${spec.charAt(0).toUpperCase() + spec.slice(1)}</th>`;
                
                // Find best value for this spec (for highlighting)
                let bestValue = null;
                if (spec === 'horsepower') {
                    bestValue = Math.max(...selectedCars.map(car => parseInt(car.specs[spec])));
                } else if (spec === 'mpg') {
                    // Extract numeric value from MPG string
                    const mpgValues = selectedCars.map(car => {
                        const match = car.specs[spec].match(/\d+/);
                        return match ? parseInt(match[0]) : 0;
                    });
                    bestValue = Math.max(...mpgValues);
                }
                
                selectedCars.forEach(car => {
                    let value = car.specs[spec];
                    let isWinner = false;
                    
                    if (spec === 'horsepower' && parseInt(value) === bestValue) {
                        isWinner = true;
                    } else if (spec === 'mpg') {
                        const match = value.match(/\d+/);
                        if (match && parseInt(match[0]) === bestValue) {
                            isWinner = true;
                        }
                    }
                    
                    tableHTML += `<td class="spec-value ${isWinner ? 'winner' : ''}">${value}</td>`;
                });
                
                tableHTML += `</tr>`;
            });
            
            tableHTML += `</tbody>`;
            
            comparisonTable.innerHTML = tableHTML;
            
            // Navigate to comparison page
            navigateToPage('compare');
        }

        // Navigation functions
        function navigateToPage(pageId) {
            // Update active page
            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // Update active nav link
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === pageId) {
                    link.classList.add('active');
                }
            });
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Event listeners
        typeFilter.addEventListener('change', filterCars);
        priceFilter.addEventListener('change', filterCars);
        brandFilter.addEventListener('change', filterCars);
        compareButton.addEventListener('click', compareCars);

        // Navigation event listeners
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                 if (link.id === 'stats-link') 
            {
            // Allow default behavior (navigation to stats.html)
            return;
            }
                e.preventDefault();
                navigateToPage(link.getAttribute('data-page'));
            });
        });

        // Button event listeners
        document.querySelectorAll('.btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                if (btn.hasAttribute('data-page')) {
                    e.preventDefault();
                    navigateToPage(btn.getAttribute('data-page'));
                }
            });
        });

        // Initial render
        renderCars(cars);

        // ============================================
        // TensorFlow.js Price Prediction Model
        // ============================================
        
        let priceModel = null;
        let modelReady = false;
        let normalizationParams = {
            horsepower: { min: 0, max: 0, mean: 0, std: 0 },
            mpg: { min: 0, max: 0, mean: 0, std: 0 },
            seating: { min: 0, max: 0, mean: 0, std: 0 },
            price: { min: 0, max: 0, mean: 0, std: 0 }
        };

        // Update status indicator
        function updateStatus(message, ready = false) {
            const statusElement = document.getElementById('model-status');
            const statusIcon = document.getElementById('status-icon');
            const indicator = document.querySelector('.status-indicator');
            
            statusElement.textContent = message;
            
            if (ready) {
                statusIcon.className = 'fas fa-check-circle';
                indicator.classList.add('ready');
                modelReady = true;
            } else {
                statusIcon.className = 'fas fa-circle-notch fa-spin';
            }
        }

        // Extract numeric value from MPG string
        function extractMPG(mpgString) {
            const match = mpgString.match(/\d+/);
            return match ? parseInt(match[0]) : 0;
        }

        // Normalize data for training
        function calculateNormalizationParams(data, field) {
            const values = data.map(item => item[field]);
            const min = Math.min(...values);
            const max = Math.max(...values);
            const mean = values.reduce((a, b) => a + b, 0) / values.length;
            const std = Math.sqrt(values.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / values.length);
            
            return { min, max, mean, std };
        }

        // Normalize value
        function normalize(value, params) {
            return (value - params.min) / (params.max - params.min + 0.0001);
        }

        // Denormalize value
        function denormalize(value, params) {
            return value * (params.max - params.min) + params.min;
        }

        // Encode categorical features
        function encodeCategorical(value, type) {
            const encodings = {
                type: { sedan: 0, suv: 0.33, truck: 0.66, electric: 1 },
                drive: { FWD: 0, RWD: 0.5, AWD: 1 },
                brand: { economy: 0, luxury: 0.5, premium: 1 }
            };
            
            return encodings[type][value] || 0;
        }

        // Get brand category from car brand
        function getBrandCategory(brand) {
            const economy = ['toyota', 'honda', 'nissan', 'hyundai', 'kia', 'mazda', 'subaru'];
            const luxury = ['bmw', 'mercedes', 'audi'];
            const premium = ['lexus', 'cadillac', 'genesis'];
            
            if (economy.includes(brand)) return 'economy';
            if (luxury.includes(brand)) return 'luxury';
            if (premium.includes(brand)) return 'premium';
            return 'economy';
        }

        // Prepare training data
        function prepareTrainingData() {
            const trainingData = cars.map(car => {
                const horsepower = parseInt(car.specs.horsepower);
                const mpg = extractMPG(car.specs.mpg);
                const seating = car.specs.seating;
                const price = car.price;
                const type = car.type;
                const drive = car.specs.drive;
                const brand = getBrandCategory(car.brand);
                
                return { horsepower, mpg, seating, price, type, drive, brand };
            });
            
            // Calculate normalization parameters
            normalizationParams.horsepower = calculateNormalizationParams(trainingData, 'horsepower');
            normalizationParams.mpg = calculateNormalizationParams(trainingData, 'mpg');
            normalizationParams.seating = calculateNormalizationParams(trainingData, 'seating');
            normalizationParams.price = calculateNormalizationParams(trainingData, 'price');
            
            return trainingData;
        }

        // Create and train the model
        async function createAndTrainModel() {
            updateStatus('Initializing TensorFlow.js model...');
            
            // Prepare data
            const trainingData = prepareTrainingData();
            
            // Create features and labels
            const features = trainingData.map(data => [
                normalize(data.horsepower, normalizationParams.horsepower),
                normalize(data.mpg, normalizationParams.mpg),
                normalize(data.seating, normalizationParams.seating),
                encodeCategorical(data.type, 'type'),
                encodeCategorical(data.drive, 'drive'),
                encodeCategorical(data.brand, 'brand')
            ]);
            
            const labels = trainingData.map(data => 
                normalize(data.price, normalizationParams.price)
            );
            
            // Convert to tensors
            const xs = tf.tensor2d(features);
            const ys = tf.tensor2d(labels, [labels.length, 1]);
            
            // Create model
            const model = tf.sequential({
                layers: [
                    tf.layers.dense({ inputShape: [6], units: 64, activation: 'relu' }),
                    tf.layers.dropout({ rate: 0.2 }),
                    tf.layers.dense({ units: 32, activation: 'relu' }),
                    tf.layers.dropout({ rate: 0.2 }),
                    tf.layers.dense({ units: 16, activation: 'relu' }),
                    tf.layers.dense({ units: 1, activation: 'linear' })
                ]
            });
            
            // Compile model
            model.compile({
                optimizer: tf.train.adam(0.001),
                loss: 'meanSquaredError',
                metrics: ['mae']
            });
            
            updateStatus('Training model on ' + trainingData.length + ' vehicles...');
            
            // Train model
            await model.fit(xs, ys, {
                epochs: 100,
                batchSize: 8,
                validationSplit: 0.2,
                verbose: 0,
                callbacks: {
                    onEpochEnd: (epoch, logs) => {
                        if (epoch % 10 === 0) {
                            updateStatus(`Training... Epoch ${epoch}/100 (Loss: ${logs.loss.toFixed(4)})`);
                        }
                    }
                }
            });
            
            // Clean up tensors
            xs.dispose();
            ys.dispose();
            
            priceModel = model;
            updateStatus(`✓ Model ready! Trained on ${trainingData.length} vehicles`, true);
            
            // Update training samples count
            document.getElementById('training-samples').textContent = trainingData.length;
            
            // Enable prediction form
            document.getElementById('predict-btn').disabled = false;
        }

        // Make prediction
        async function predictPrice(inputData) {
            if (!priceModel || !modelReady) {
                alert('Model is still training. Please wait...');
                return null;
            }
            
            // Prepare input features
            const features = [
                normalize(inputData.horsepower, normalizationParams.horsepower),
                normalize(inputData.mpg, normalizationParams.mpg),
                normalize(inputData.seating, normalizationParams.seating),
                encodeCategorical(inputData.type, 'type'),
                encodeCategorical(inputData.drive, 'drive'),
                encodeCategorical(inputData.brand, 'brand')
            ];
            
            // Create tensor and predict
            const inputTensor = tf.tensor2d([features]);
            const prediction = priceModel.predict(inputTensor);
            const normalizedPrice = await prediction.data();
            
            // Clean up
            inputTensor.dispose();
            prediction.dispose();
            
            // Denormalize prediction
            const predictedPrice = denormalize(normalizedPrice[0], normalizationParams.price);
            
            return Math.round(predictedPrice);
        }

        // Handle form submission
        document.getElementById('prediction-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!modelReady) {
                alert('Model is still training. Please wait...');
                return;
            }
            
            // Get form values
            const inputData = {
                horsepower: parseInt(document.getElementById('input-horsepower').value),
                mpg: parseInt(document.getElementById('input-mpg').value),
                seating: parseInt(document.getElementById('input-seating').value),
                type: document.getElementById('input-type').value,
                drive: document.getElementById('input-drive').value,
                brand: document.getElementById('input-brand').value
            };
            
            // Show loading state
            const predictBtn = document.getElementById('predict-btn');
            const originalText = predictBtn.innerHTML;
            predictBtn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Predicting...';
            predictBtn.disabled = true;
            
            // Make prediction
            const predictedPrice = await predictPrice(inputData);
            
            if (predictedPrice) {
                // Display result
                document.getElementById('predicted-price').textContent = 
                    '$' + predictedPrice.toLocaleString();
                document.getElementById('prediction-result').style.display = 'block';
                
                // Scroll to result
                document.getElementById('prediction-result').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }
            
            // Reset button
            predictBtn.innerHTML = originalText;
            predictBtn.disabled = false;
        });

        // Initialize model when TensorFlow.js is loaded
        async function initializePricePredictor() {
            try {
                // Check if TensorFlow.js is loaded
                if (typeof tf === 'undefined') {
                    updateStatus('Error: TensorFlow.js failed to load');
                    return;
                }
                
                // Disable predict button initially
                document.getElementById('predict-btn').disabled = true;
                
                // Create and train model
                await createAndTrainModel();
                
            } catch (error) {
                console.error('Error initializing model:', error);
                updateStatus('Error loading model: ' + error.message);
            }
        }

        // Initialize when page loads (after TensorFlow.js is loaded)
        window.addEventListener('load', () => {
            // Wait a bit for TensorFlow.js to fully initialize
            setTimeout(initializePricePredictor, 500);
        });
    </script>
</body>
</html>